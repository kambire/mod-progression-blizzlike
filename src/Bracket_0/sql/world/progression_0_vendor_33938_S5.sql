/* ---------------------------------------------------------
   NPC 33938 - BORRAR TODO y CARGAR VENDOR (lista del HTML)
   AzerothCore WotLK - MySQL 8.4/8.6
   - Sin variables
   - Incluye limpieza npc_vendor + game_event_npc_vendor (si aplica)
--------------------------------------------------------- */

START TRANSACTION;

-- =========================================================
-- A) BACKUP + LIMPIEZA en npc_vendor (por entry)
-- =========================================================

DROP TABLE IF EXISTS `backupKambi_npc_vendor_33938_20251231`;
CREATE TABLE `backupKambi_npc_vendor_33938_20251231` LIKE `npc_vendor`;

INSERT INTO `backupKambi_npc_vendor_33938_20251231`
SELECT *
FROM `npc_vendor`
WHERE `entry` = 33938;

DELETE FROM `npc_vendor`
WHERE `entry` = 33938;

-- =========================================================
-- B) LIMPIEZA por EVENTO (si el vendor est√° por game_event_npc_vendor)
--    Esto borra TODO lo asociado a los GUID spawneados con id1=33938
-- =========================================================

DROP TABLE IF EXISTS `backupKambi_game_event_npc_vendor_33938_20251231`;
CREATE TABLE `backupKambi_game_event_npc_vendor_33938_20251231` LIKE `game_event_npc_vendor`;

INSERT INTO `backupKambi_game_event_npc_vendor_33938_20251231`
SELECT gev.*
FROM `game_event_npc_vendor` gev
JOIN `creature` c ON c.`guid` = gev.`guid`
WHERE c.`id1` = 33938;

DELETE gev
FROM `game_event_npc_vendor` gev
JOIN `creature` c ON c.`guid` = gev.`guid`
WHERE c.`id1` = 33938;

-- =========================================================
-- C) INSERT: vendor correcto en npc_vendor (entry=33938)
--    ExtendedCost:
--    2440 = 350 Arena + 12000 Honor
--    2441 = 200 Arena + 7200 Honor
--    2445 = 275 Arena + 9600 Honor
-- =========================================================

INSERT INTO `npc_vendor`
(`entry`, `slot`, `item`, `maxcount`, `incrtime`, `ExtendedCost`)
VALUES
(33938, 0, 40778, 0, 0, 2440),
(33938, 1, 40779, 0, 0, 2440),
(33938, 2, 40780, 0, 0, 2440),
(33938, 3, 40797, 0, 0, 2441),
(33938, 4, 40798, 0, 0, 2441),
(33938, 5, 40799, 0, 0, 2441),
(33938, 6, 40816, 0, 0, 2440),
(33938, 7, 40817, 0, 0, 2440),
(33938, 8, 40818, 0, 0, 2440),
(33938, 9, 40836, 0, 0, 2440),
(33938, 10, 40837, 0, 0, 2440),
(33938, 11, 40838, 0, 0, 2440),
(33938, 12, 40856, 0, 0, 2445),
(33938, 13, 40857, 0, 0, 2445),
(33938, 14, 40858, 0, 0, 2445),
(33938, 15, 40898, 0, 0, 2440),
(33938, 16, 40918, 0, 0, 2441),
(33938, 17, 40930, 0, 0, 2440),
(33938, 18, 40936, 0, 0, 2440),
(33938, 19, 40960, 0, 0, 2445),
(33938, 20, 40986, 0, 0, 2440),
(33938, 21, 40987, 0, 0, 2440),
(33938, 22, 40998, 0, 0, 2441),
(33938, 23, 41004, 0, 0, 2441),
(33938, 24, 41010, 0, 0, 2440),
(33938, 25, 41016, 0, 0, 2440),
(33938, 26, 41023, 0, 0, 2440),
(33938, 27, 41024, 0, 0, 2445),
(33938, 28, 41030, 0, 0, 2440),
(33938, 29, 41041, 0, 0, 2445),
(33938, 30, 41078, 0, 0, 2440),
(33938, 31, 41084, 0, 0, 2440),
(33938, 32, 41134, 0, 0, 2441),
(33938, 33, 41140, 0, 0, 2441),
(33938, 34, 41148, 0, 0, 2440),
(33938, 35, 41154, 0, 0, 2440),
(33938, 36, 41160, 0, 0, 2440),
(33938, 37, 41202, 0, 0, 2440),
(33938, 38, 41208, 0, 0, 2445),
(33938, 39, 41214, 0, 0, 2445),
(33938, 40, 41268, 0, 0, 2441),
(33938, 41, 41269, 0, 0, 2440),
(33938, 42, 41270, 0, 0, 2440),
(33938, 43, 41271, 0, 0, 2445),
(33938, 44, 41272, 0, 0, 2440),
(33938, 45, 41278, 0, 0, 2445),
(33938, 46, 41290, 0, 0, 2441),
(33938, 47, 41301, 0, 0, 2440),
(33938, 48, 41313, 0, 0, 2440),
(33938, 49, 41324, 0, 0, 2440),
(33938, 50, 41643, 0, 0, 2441),
(33938, 51, 41644, 0, 0, 2440),
(33938, 52, 41645, 0, 0, 2440),
(33938, 53, 41646, 0, 0, 2445),
(33938, 54, 41647, 0, 0, 2440),
(33938, 55, 41658, 0, 0, 2440),
(33938, 56, 41664, 0, 0, 2440),
(33938, 57, 41675, 0, 0, 2440),
(33938, 58, 41712, 0, 0, 2445),
(33938, 59, 41770, 0, 0, 2441),
(33938, 60, 41847, 0, 0, 2441),
(33938, 61, 41848, 0, 0, 2440),
(33938, 62, 41849, 0, 0, 2440),
(33938, 63, 41850, 0, 0, 2445),
(33938, 64, 41851, 0, 0, 2440),
(33938, 65, 41912, 0, 0, 2440),
(33938, 66, 41918, 0, 0, 2440),
(33938, 67, 41924, 0, 0, 2440),
(33938, 68, 41930, 0, 0, 2445),
(33938, 69, 41937, 0, 0, 2441),
(33938, 70, 41943, 0, 0, 2440),
(33938, 71, 41949, 0, 0, 2440),
(33938, 72, 41956, 0, 0, 2440),
(33938, 73, 41962, 0, 0, 2445),
(33938, 74, 41968, 0, 0, 2441),
(33938, 75, 41990, 0, 0, 2440),
(33938, 76, 41996, 0, 0, 2440),
(33938, 77, 42002, 0, 0, 2440),
(33938, 78, 42008, 0, 0, 2445),
(33938, 79, 42014, 0, 0, 2441);

COMMIT;

-- =========================================================
-- D) CHECKS
-- =========================================================
SELECT DATABASE() AS current_db;

SELECT COUNT(*) AS npc_vendor_items_33938
FROM `npc_vendor`
WHERE `entry` = 33938;

SELECT *
FROM `npc_vendor`
WHERE `entry` = 33938
ORDER BY `slot`, `item`;

-- Si esto devuelve filas, el NPC sigue teniendo vendor por EVENTO (por GUID)
SELECT gev.eventEntry, gev.guid, gev.item, gev.ExtendedCost
FROM `game_event_npc_vendor` gev
JOIN `creature` c ON c.`guid` = gev.`guid`
WHERE c.`id1` = 33938
ORDER BY gev.eventEntry, gev.guid, gev.item;
